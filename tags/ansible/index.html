<!doctype html><html lang=en><head><title>Ansible :: blog.oddbit.com</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content><meta name=keywords content><meta name=robots content="noodp"><link rel=canonical href=https://blog.oddbit.com/tags/ansible/><script async src="https://www.googletagmanager.com/gtag/js?id=G-G1FYT93ENG"></script><script>var dnt,doNotTrack=!1;if(!1&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-G1FYT93ENG")}</script><link rel=stylesheet href=https://blog.oddbit.com/css/buttons.min.86f6b4c106b6c6eb690ae5203d36b442c1f66f718ff4e8164fa86cf6c61ad641.css><link rel=stylesheet href=https://blog.oddbit.com/css/code.min.d529ea4b2fb8d34328d7d31afc5466d5f7bc2f0bc9abdd98b69385335d7baee4.css><link rel=stylesheet href=https://blog.oddbit.com/css/fonts.min.5bb7ed13e1d00d8ff39ea84af26737007eb5051b157b86fc24487c94f3dc8bbe.css><link rel=stylesheet href=https://blog.oddbit.com/css/footer.min.eb8dfc2c6a7eafa36cd3ba92d63e69e849e2200e0002a228d137f236b09ecd75.css><link rel=stylesheet href=https://blog.oddbit.com/css/gist.min.a751e8b0abe1ba8bc53ced52a38b19d8950fe78ca29454ea8c2595cf26aad5c0.css><link rel=stylesheet href=https://blog.oddbit.com/css/header.min.75c7eb0e2872d95ff48109c6647d0223a38db52e2561dd87966eb5fc7c6bdac6.css><link rel=stylesheet href=https://blog.oddbit.com/css/main.min.36833afd348409fc6c3d09d0897c5833d9d5bf1ff31f5e60ea3ee42ce2b1268c.css><link rel=stylesheet href=https://blog.oddbit.com/css/menu.min.3c17467ebeb3d38663dce68f71f519901124fa5cbb4519b2fb0667a21e9aca39.css><link rel=stylesheet href=https://blog.oddbit.com/css/pagination.min.bbb986dbce00a5ce5aca0504b7925fc1c581992a4bf57f163e5d69cc1db7d836.css><link rel=stylesheet href=https://blog.oddbit.com/css/post.min.e6dddd258e64c83e05cec0cd49c05216742d42fc8ecbfbe6b67083412b609bd3.css><link rel=stylesheet href=https://blog.oddbit.com/css/syntax.min.a0773cce9310cb6d8ed23e50f005448facf29a53001b57e038828daa466b25c0.css><link rel=stylesheet href=https://blog.oddbit.com/css/terminal.min.e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855.css><link rel=stylesheet href=https://blog.oddbit.com/css/terms.min.b81791663c3790e738e571cdbf802312390d30e4b1d8dc9d814a5b5454d0ac11.css><link rel=stylesheet href=https://blog.oddbit.com/style.css><link rel="shortcut icon" href=https://blog.oddbit.com/favicon.png><link rel=apple-touch-icon href=https://blog.oddbit.com/apple-touch-icon.png><meta name=twitter:card content="summary"><meta property="og:locale" content="en"><meta property="og:type" content="website"><meta property="og:title" content="Ansible"><meta property="og:description" content><meta property="og:url" content="https://blog.oddbit.com/tags/ansible/"><meta property="og:site_name" content="blog.oddbit.com"><meta property="og:image" content="https://blog.oddbit.com/og-image.png"><meta property="og:image:width" content="1200"><meta property="og:image:height" content="627"><link href=/tags/ansible/rss.xml rel=alternate type=application/rss+xml title=blog.oddbit.com></head><body><div class="container center"><header class=header><div class=header__inner><div class=header__logo><a href=/><div class=logo>the odd bit blog</div></a></div><ul class="menu menu--mobile"><li class=menu__trigger>Menu&nbsp;▾</li><li><ul class=menu__dropdown><li><a href=/>/</a></li><li><a href=https://oddbit.com>/about</a></li><li><a href=/posts>/posts</a></li><li><a href=/tags>/tags</a></li><li><a href=/archive>/archive</a></li><li><a href=/rss.xml>/feed</a></li><li><a href=https://github.com/larsks>→Github</a></li><li><a href=https://hachyderm.io/@larsks>→Mastodon</a></li><li><a href=https://twitter.com/larsks>→Twitter</a></li></ul></li></ul></div><nav class=navigation-menu><ul class="navigation-menu__inner menu--desktop"><li><a href=/>/</a></li><li><a href=https://oddbit.com>/about</a></li><li><a href=/posts>/posts</a></li><li><a href=/tags>/tags</a></li><li><a href=/archive>/archive</a></li><li><a href=/rss.xml>/feed</a></li><li><ul class=menu><li class=menu__trigger>&nbsp;▾</li><li><ul class=menu__dropdown><li><a href=https://github.com/larsks>→Github</a></li><li><a href=https://hachyderm.io/@larsks>→Mastodon</a></li><li><a href=https://twitter.com/larsks>→Twitter</a></li></ul></li></ul></li></ul></nav></header><div class=content><h1>Posts for: #Ansible</h1><div class=posts><article class="post on-list"><h1 class=post-title><a href=https://blog.oddbit.com/post/2019-04-26-adding-support-for-privilege-e/>Adding support for privilege escalation to Ansible&rsquo;s docker connection driver</a></h1><div class=post-meta><time class=post-date>2019-04-26</time></div><span class=post-tags>#<a href=https://blog.oddbit.com/tags/ansible/>ansible</a>&nbsp;
#<a href=https://blog.oddbit.com/tags/pull-request/>pull-request</a>&nbsp;</span><div class=post-content><p><strong>Update 2019-05-09</strong> Pull request
<a href=https://github.com/ansible/ansible/pull/55816 class=pull-request>#55816</a>
has merged, so you can now use <code>sudo</code> with the <code>docker</code> connection driver even when <code>sudo</code> is configured to require a password.</p><hr><p>I often use Docker to test out Ansible playbooks. While normally that works great, I recently ran into an unexpected problem with privilege escalation. Given a simple playbook like this:</p><pre><code>---
- hosts: all
  gather_facts: false
  become: true
  tasks:
    - ping:
</code></pre><p>And an inventory like this:</p></div><div><a class="read-more button inline" href=/post/2019-04-26-adding-support-for-privilege-e/>[read more]</a></div></article><article class="post on-list"><h1 class=post-title><a href=https://blog.oddbit.com/post/2019-04-25-writing-ansible-filter-plugins/>Writing Ansible filter plugins</a></h1><div class=post-meta><time class=post-date>2019-04-25</time></div><span class=post-tags>#<a href=https://blog.oddbit.com/tags/ansible/>ansible</a>&nbsp;
#<a href=https://blog.oddbit.com/tags/python/>python</a>&nbsp;</span><div class=post-content><p>I often see questions from people who are attemping to perform complex text transformations in their <a href=https://www.ansible.com/>Ansible</a> playbooks. While I am a huge fan of Ansible, data transformation is not one of its strong points. For example, this past week someone <a href=https://stackoverflow.com/questions/55853384/ansible-build-list-dictionary-with-from-list-of-strings/55854394>asked a question</a> on Stack Overflow in which they were attempting to convert the output of the <a href=https://docs.oracle.com/javase/8/docs/technotes/tools/unix/keytool.html>keytool</a> command into a list of dictionaries. The output of the <code>keytool -list -v</code> command looks something like this:</p></div><div><a class="read-more button inline" href=/post/2019-04-25-writing-ansible-filter-plugins/>[read more]</a></div></article><article class="post on-list"><h1 class=post-title><a href=https://blog.oddbit.com/post/2018-10-19-integrating-bitwarden-with-ans/>Integrating Bitwarden with Ansible</a></h1><div class=post-meta><time class=post-date>2018-10-19</time></div><span class=post-tags>#<a href=https://blog.oddbit.com/tags/bitwarden/>bitwarden</a>&nbsp;
#<a href=https://blog.oddbit.com/tags/security/>security</a>&nbsp;
#<a href=https://blog.oddbit.com/tags/ansible/>ansible</a>&nbsp;
#<a href=https://blog.oddbit.com/tags/pull-request/>pull-request</a>&nbsp;</span><div class=post-content><p><a href=https://bitwarden.com>Bitwarden</a> is a password management service (like <a href=https://www.lastpass.com/>LastPass</a> or
<a href=https://1password.com/>1Password</a>). It&rsquo;s unique in that it is built entirely on open
source software. In addition to the the web UI and mobile apps that
you would expect, Bitwarden also provides a <a href=https://help.bitwarden.com/article/cli/>command-line tool</a> for
interacting with the your password store.</p><p>At $WORK(-ish) we&rsquo;re looking into Bitwarden because we want a password
sharing and management solution that was better than dropping files
into directories on remote hosts or sharing things over Slack. At
the same time, we are also thinking about bringing more automation to
our operational environment, possibly by making more extensive use of
<a href=https://ansible.com>Ansible</a>. It looked like all the pieces were available to use
Bitwarden as a credential storage mechanism for Ansible playbooks, so
I set out to write a lookup plugin to implement the integration&mldr;</p></div><div><a class="read-more button inline" href=/post/2018-10-19-integrating-bitwarden-with-ans/>[read more]</a></div></article><article class="post on-list"><h1 class=post-title><a href=https://blog.oddbit.com/post/2018-01-24-safely-restarting-an-openstack/>Safely restarting an OpenStack server with Ansible</a></h1><div class=post-meta><time class=post-date>2018-01-24</time></div><span class=post-tags>#<a href=https://blog.oddbit.com/tags/ansible/>ansible</a>&nbsp;
#<a href=https://blog.oddbit.com/tags/openstack/>openstack</a>&nbsp;</span><div class=post-content><p>The other day on <a href=http://docs.ansible.com/ansible/latest/community.html#irc-channel>#ansible</a>, someone was looking for a way to safely
shut down a Nova server, wait for it to stop, and then start it up
again using the <code>openstack</code> cli. The first part seemed easy:</p><pre><code>- hosts: myserver
  tasks:
    - name: shut down the server
      command: poweroff
      become: true
</code></pre><p>&mldr;but that will actually fail with the following result:</p><pre><code>TASK [shut down server] *************************************
fatal: [myserver]: UNREACHABLE! =&gt; {&quot;changed&quot;: false, &quot;msg&quot;:
&quot;Failed to connect to the host via ssh: Shared connection to
10.0.0.103 closed.\r\n&quot;, &quot;unreachable&quot;: true}
</code></pre><p>This happens because running <code>poweroff</code> immediately closes Ansible&rsquo;s
ssh connection. The workaround here is to use a &ldquo;fire-and-forget&rdquo;
<a href=http://docs.ansible.com/ansible/latest/playbooks_async.html>asynchronous task</a>:</p></div><div><a class="read-more button inline" href=/post/2018-01-24-safely-restarting-an-openstack/>[read more]</a></div></article><article class="post on-list"><h1 class=post-title><a href=https://blog.oddbit.com/post/2017-08-02-ansible-for-infrastructure-tes/>Ansible for Infrastructure Testing</a></h1><div class=post-meta><time class=post-date>2017-08-02</time></div><span class=post-tags>#<a href=https://blog.oddbit.com/tags/ansible/>ansible</a>&nbsp;
#<a href=https://blog.oddbit.com/tags/ansible-assertive/>ansible-assertive</a>&nbsp;
#<a href=https://blog.oddbit.com/tags/openstack/>openstack</a>&nbsp;</span><div class=post-content><p>At <code>$JOB</code> we often find ourselves at customer sites where we see the
same set of basic problems that we have previously encountered
elsewhere (&ldquo;your clocks aren&rsquo;t in sync&rdquo; or &ldquo;your filesystem is full&rdquo;
or &ldquo;you haven&rsquo;t installed a critical update&rdquo;, etc). We would like a
simple tool that could be run either by the customer or by our own
engineers to test for and report on these common issues.
Fundamentally, we want something that acts like a typical code test
suite, but for infrastructure.</p></div><div><a class="read-more button inline" href=/post/2017-08-02-ansible-for-infrastructure-tes/>[read more]</a></div></article><article class="post on-list"><h1 class=post-title><a href=https://blog.oddbit.com/post/2016-02-19-deploy-an-ha-openstack-develop/>Deploying an HA OpenStack development environment with tripleo-quickstart</a></h1><div class=post-meta><time class=post-date>2016-02-19</time></div><span class=post-tags>#<a href=https://blog.oddbit.com/tags/openstack/>openstack</a>&nbsp;
#<a href=https://blog.oddbit.com/tags/tripleo/>tripleo</a>&nbsp;
#<a href=https://blog.oddbit.com/tags/rdo/>rdo</a>&nbsp;
#<a href=https://blog.oddbit.com/tags/ansible/>ansible</a>&nbsp;</span><div class=post-content><p>In this article I would like to introduce <a href=https://github.com/redhat-openstack/tripleo-quickstart>tripleo-quickstart</a>, a
tool that will automatically provision a virtual environment and then
use <a href=http://docs.openstack.org/developer/tripleo-docs/>TripleO</a> to deploy an HA OpenStack on top of it.</p><h2 id=introducing-tripleo-quickstart>Introducing Tripleo-Quickstart</h2><p>The goal of the <a href=https://github.com/redhat-openstack/tripleo-quickstart>Tripleo-Quickstart</a> project is to replace the
<code>instack-virt-setup</code> tool for quickly setting up virtual TripleO
environments, and to ultimately become the tool used by both
developers and upstream CI for this purpose. The project is a set of
<a href=http://ansible.com/>Ansible</a> playbooks that will take care of:</p></div><div><a class="read-more button inline" href=/post/2016-02-19-deploy-an-ha-openstack-develop/>[read more]</a></div></article><article class="post on-list"><h1 class=post-title><a href=https://blog.oddbit.com/post/2016-02-08-a-systemd-nspawn-connection-dr/>A systemd-nspawn connection driver for Ansible</a></h1><div class=post-meta><time class=post-date>2016-02-08</time></div><span class=post-tags>#<a href=https://blog.oddbit.com/tags/ansible/>ansible</a>&nbsp;
#<a href=https://blog.oddbit.com/tags/systemd/>systemd</a>&nbsp;
#<a href=https://blog.oddbit.com/tags/pull-request/>pull-request</a>&nbsp;</span><div class=post-content><p>I wrote <a href=https://blog.oddbit.com/post/2016-02-07-systemd-nspawn-for-fun-and-wel/>earlier</a> about <a href=https://www.freedesktop.org/software/systemd/man/systemd-nspawn.html>systemd-nspawn</a>, and how it can take much
of the fiddly work out of setting up functional <code>chroot</code> environments.
I&rsquo;m a regular <a href=http://ansible.com/>Ansible</a> user, and I wanted to be able to apply some
of those techniques to my playbooks.</p><p>Ansible already has a <code>chroot</code> module, of course, but for some
situations &ndash; such as targeting an emulated <code>chroot</code> environment &ndash;
that just means a lot of extra work. Using <code>systemd-nspawn</code> makes
this trivial.</p></div><div><a class="read-more button inline" href=/post/2016-02-08-a-systemd-nspawn-connection-dr/>[read more]</a></div></article><article class="post on-list"><h1 class=post-title><a href=https://blog.oddbit.com/post/2016-02-07-folding-long-lines-in-ansible-/>Folding long lines in Ansible inventory files</a></h1><div class=post-meta><time class=post-date>2016-02-07</time></div><span class=post-tags>#<a href=https://blog.oddbit.com/tags/ansible/>ansible</a>&nbsp;
#<a href=https://blog.oddbit.com/tags/pull-request/>pull-request</a>&nbsp;</span><div class=post-content><p>If you have an Ansible inventory file that includes lots of per host
variables, it&rsquo;s not unusual for lines to get long enough that they
become unwieldly, particularly if you want to discuss them in an email
or write about them in some context (e.g., a blog post).</p><p>I&rsquo;ve just submitted pull request <a href=https://github.com/ansible/ansible/pull/14359>#14359</a> to Ansible which
implements support for folding long lines using the INI-format
convention of using indent to mark extended logical lines.</p></div><div><a class="read-more button inline" href=/post/2016-02-07-folding-long-lines-in-ansible-/>[read more]</a></div></article><article class="post on-list"><h1 class=post-title><a href=https://blog.oddbit.com/post/2015-10-26-ansible-20-new-openstack-modul/>Ansible 2.0: New OpenStack modules</a></h1><div class=post-meta><time class=post-date>2015-10-26</time></div><span class=post-tags>#<a href=https://blog.oddbit.com/tags/ansible/>ansible</a>&nbsp;
#<a href=https://blog.oddbit.com/tags/openstack/>openstack</a>&nbsp;
#<a href=https://blog.oddbit.com/tags/ansible_20_series/>ansible_20_series</a>&nbsp;
#<a href=https://blog.oddbit.com/tags/pull-request/>pull-request</a>&nbsp;</span><div class=post-content><p>This is the second in a loose sequence of articles looking at new
features in Ansible 2.0. In the previous article I looked at the
<a href=https://blog.oddbit.com/post/2015-10-13-ansible-20-the-docker-connecti/>Docker connection driver</a>. In this article, I would like to
provide an overview of the new-and-much-improved suite of modules for
interacting with an <a href=http://www.openstack.org/>OpenStack</a> environment, and provide a few
examples of their use.</p><p>In versions of Ansible prior to 2.0, there was a small collection of
OpenStack modules. There was the minimum necessary to boot a Nova
instance:</p></div><div><a class="read-more button inline" href=/post/2015-10-26-ansible-20-new-openstack-modul/>[read more]</a></div></article><article class="post on-list"><h1 class=post-title><a href=https://blog.oddbit.com/post/2015-10-19-stupid-ansible-tricks-running-/>Stupid Ansible Tricks: Running a role from the command line</a></h1><div class=post-meta><time class=post-date>2015-10-19</time></div><span class=post-tags>#<a href=https://blog.oddbit.com/tags/ansible/>ansible</a>&nbsp;</span><div class=post-content><p>When writing <a href=http://www.ansible.com/>Ansible</a> roles I occasionally want a way to just run a
role from the command line, without having to muck about with a
playbook. I&rsquo;ve seen <a href=https://groups.google.com/forum/#!topic/ansible-project/h-SGLuPDRrs>similar</a> <a href=https://groups.google.com/forum/#!topic/ansible-devel/GqzZ6zsn6eY>requests</a> on the mailing lists
and on irc.</p><p>I&rsquo;ve thrown together a quick wrapper that will allow you (and me!) to
do exactly that, called <a href=http://github.com/larsks/ansible-role>ansible-role</a>. The <code>--help</code> output looks
like this:</p><pre><code>usage: ansible-role [-h] [--verbose] [--gather] [--no-gather]
                    [--extra-vars EXTRA_VARS] [-i INVENTORY] [--hosts HOSTS]
                    [--sudo] [--become] [--user USER]
                    role

positional arguments:
  role

optional arguments:
  -h, --help            show this help message and exit
  --verbose, -v
  --gather, -g
  --no-gather, -G
  --extra-vars EXTRA_VARS, -e EXTRA_VARS

Inventory:
  -i INVENTORY, --inventory INVENTORY
  --hosts HOSTS, -H HOSTS

Identity:
  --sudo, -s
  --become, -b
  --user USER, -u USER
</code></pre><h2 id=example>Example</h2><p>If you have a role <code>roles/testrole</code> that contains the following in
<code>tasks/main.yml</code>:</p></div><div><a class="read-more button inline" href=/post/2015-10-19-stupid-ansible-tricks-running-/>[read more]</a></div></article><div class=pagination><div class=pagination__buttons><a href=/tags/ansible/page/2/ class="button inline next">[<span class=button__text>Older posts</span>] ></a></div></div></div></div><footer class=footer><div class=footer__inner><div class="copyright copyright--user"><span>Lars Kellogg-Stedman</span>
<span>:: <a href=https://github.com/panr/hugo-theme-terminal target=_blank>Theme</a> made by <a href=https://github.com/panr target=_blank>panr</a></span></div></div></footer><script type=text/javascript src=/bundle.min.js></script><script src=/js/mermaid.min.js></script><script>mermaid.initialize({startOnLoad:!0})</script></div></body></html>