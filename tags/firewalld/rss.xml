<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>firewalld on blog.oddbit.com</title><link>https://blog.oddbit.com/tags/firewalld/</link><description>Recent content in firewalld on blog.oddbit.com</description><generator>Hugo -- gohugo.io</generator><language>en-us</language><copyright>Lars Kellogg-Stedman</copyright><lastBuildDate>Tue, 20 May 2014 00:00:00 +0000</lastBuildDate><atom:link href="https://blog.oddbit.com/tags/firewalld/rss.xml" rel="self" type="application/rss+xml"/><item><title>Firewalld, NetworkManager, and OpenStack</title><link>https://blog.oddbit.com/post/2014-05-20-firewalld-and-openstack/</link><pubDate>Tue, 20 May 2014 00:00:00 +0000</pubDate><guid>https://blog.oddbit.com/post/2014-05-20-firewalld-and-openstack/</guid><description>These are my notes on making OpenStack play well with firewalld and NetworkManager.
NetworkManager By default, NetworkManager attempts to start a DHCP client on every new available interface. Since booting a single instance in OpenStack can result in the creation of several virtual interfaces, this results in a lot of:
May 19 11:58:24 pk115wp-lkellogg NetworkManager[1357]: &amp;lt;info&amp;gt; Activation (qvb512640bd-ee) starting connection 'Wired connection 2' You can disable this behavior by adding the following to /etc/NetworkManager/NetworkManager.</description><content>&lt;p>These are my notes on making OpenStack play well with &lt;a href="https://fedoraproject.org/wiki/FirewallD">firewalld&lt;/a>
and &lt;a href="https://wiki.gnome.org/Projects/NetworkManager">NetworkManager&lt;/a>.&lt;/p>
&lt;h2 id="networkmanager">NetworkManager&lt;/h2>
&lt;p>By default, NetworkManager attempts to start a DHCP client on every
new available interface. Since booting a single instance in OpenStack
can result in the creation of several virtual interfaces, this results
in a lot of:&lt;/p>
&lt;pre>&lt;code>May 19 11:58:24 pk115wp-lkellogg NetworkManager[1357]: &amp;lt;info&amp;gt;
Activation (qvb512640bd-ee) starting connection 'Wired connection 2'
&lt;/code>&lt;/pre>
&lt;p>You can disable this behavior by adding the following to
&lt;code>/etc/NetworkManager/NetworkManager.conf&lt;/code>:&lt;/p>
&lt;pre>&lt;code>[main]
no-auto-default=*
&lt;/code>&lt;/pre>
&lt;p>From &lt;code>NetworkManager.conf(5)&lt;/code>:&lt;/p>
&lt;blockquote>
&lt;p>Comma-separated list of devices for which NetworkManager shouldn&amp;rsquo;t
create default wired connection (Auto eth0). By default,
NetworkManager creates a temporary wired connection for any
Ethernet device that is managed and doesn&amp;rsquo;t have a connection
configured. List a device in this option to inhibit creating the
default connection for the device. May have the special value * to
apply to all devices.&lt;/p>
&lt;/blockquote>
&lt;h2 id="firewalld">FirewallD&lt;/h2>
&lt;p>&lt;a href="https://fedoraproject.org/wiki/FirewallD">FirewallD&lt;/a> is the firewall manager recently introduced in Fedora
(and soon to be appearing in RHEL 7).&lt;/p>
&lt;p>I start by creating a new zone named &lt;code>openstack&lt;/code> by creating the file
&lt;code>/etc/firewalld/zones/openstack.xml&lt;/code> with the following content:&lt;/p>
&lt;pre>&lt;code>&amp;lt;?xml version=&amp;quot;1.0&amp;quot; encoding=&amp;quot;utf-8&amp;quot;?&amp;gt;
&amp;lt;zone&amp;gt;
&amp;lt;short&amp;gt;OpenStack&amp;lt;/short&amp;gt;
&amp;lt;description&amp;gt;For OpenStack services&amp;lt;/description&amp;gt;
&amp;lt;/zone&amp;gt;
&lt;/code>&lt;/pre>
&lt;p>After populating this file, you need to run &lt;code>firewall-cmd --reload&lt;/code>
to make the zone available. Note that if you&amp;rsquo;re already running
OpenStack this will hose any rules set up by Neutron or Nova, so
you&amp;rsquo;ll probably want to restart those services:&lt;/p>
&lt;pre>&lt;code># openstack-service restart nova neutron
&lt;/code>&lt;/pre>
&lt;p>I then add &lt;code>br-ex&lt;/code> to this zone, where &lt;code>br-ex&lt;/code> is the OVS bridge my
OpenStack environment uses for external connectivity:&lt;/p>
&lt;pre>&lt;code># echo ZONE=openstack &amp;gt;&amp;gt; /etc/sysconfig/network-scripts/ifcfg-br-ex
&lt;/code>&lt;/pre>
&lt;p>I run a &lt;code>dnsmasq&lt;/code> instance on my laptop to which I expect OpenStack
instances to connect, so I need to add the &lt;code>dns&lt;/code> service to this zone:&lt;/p>
&lt;pre>&lt;code># firewall-cmd --zone openstack --add-service dns
# firewall-cmd --zone openstack --add-service dns --permanent
&lt;/code>&lt;/pre>
&lt;p>I&amp;rsquo;m running &lt;code>firewall-cmd&lt;/code> twice here: the first time modifies the
currently running configuration, while the second makes the change
persistent across reboots.&lt;/p>
&lt;p>On my laptop, I handle external connectivity through NAT rather than
placing floating ips on a &amp;ldquo;real&amp;rdquo; network. To make this work, I add my
ethernet and wireless interfaces to the &lt;code>external&lt;/code> zone, which already
has ip masquerading enabled, by adding a &lt;code>ZONE&lt;/code> directive to the
appropriate interface configuration file:&lt;/p>
&lt;pre>&lt;code># echo ZONE=external &amp;gt;&amp;gt; /etc/sysconfig/network-scripts/ifcfg-em1
&lt;/code>&lt;/pre>
&lt;p>After a reboot, things look like this:&lt;/p>
&lt;pre>&lt;code># firewall-cmd --get-active-zones
openstack
interfaces: br-ex
external
interfaces: em1
public
interfaces: int-br-ex phy-br-ex qvb58cc67ca-06 qvo58cc67ca-06
# firewall-cmd --zone openstack --list-services
dns
&lt;/code>&lt;/pre></content></item></channel></rss>