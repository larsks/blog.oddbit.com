<!doctype html><html lang=en><head><title>:: blog.oddbit.com</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content><meta name=keywords content><meta name=robots content="noodp"><link rel=canonical href=https://blog.oddbit.com/posts/><script async src="https://www.googletagmanager.com/gtag/js?id=G-G1FYT93ENG"></script><script>var dnt,doNotTrack=!1;if(!1&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-G1FYT93ENG")}</script><link rel=stylesheet href=https://blog.oddbit.com/css/buttons.min.86f6b4c106b6c6eb690ae5203d36b442c1f66f718ff4e8164fa86cf6c61ad641.css><link rel=stylesheet href=https://blog.oddbit.com/css/code.min.d529ea4b2fb8d34328d7d31afc5466d5f7bc2f0bc9abdd98b69385335d7baee4.css><link rel=stylesheet href=https://blog.oddbit.com/css/fonts.min.5bb7ed13e1d00d8ff39ea84af26737007eb5051b157b86fc24487c94f3dc8bbe.css><link rel=stylesheet href=https://blog.oddbit.com/css/footer.min.eb8dfc2c6a7eafa36cd3ba92d63e69e849e2200e0002a228d137f236b09ecd75.css><link rel=stylesheet href=https://blog.oddbit.com/css/gist.min.a751e8b0abe1ba8bc53ced52a38b19d8950fe78ca29454ea8c2595cf26aad5c0.css><link rel=stylesheet href=https://blog.oddbit.com/css/header.min.75c7eb0e2872d95ff48109c6647d0223a38db52e2561dd87966eb5fc7c6bdac6.css><link rel=stylesheet href=https://blog.oddbit.com/css/main.min.36833afd348409fc6c3d09d0897c5833d9d5bf1ff31f5e60ea3ee42ce2b1268c.css><link rel=stylesheet href=https://blog.oddbit.com/css/menu.min.3c17467ebeb3d38663dce68f71f519901124fa5cbb4519b2fb0667a21e9aca39.css><link rel=stylesheet href=https://blog.oddbit.com/css/pagination.min.bbb986dbce00a5ce5aca0504b7925fc1c581992a4bf57f163e5d69cc1db7d836.css><link rel=stylesheet href=https://blog.oddbit.com/css/post.min.e6dddd258e64c83e05cec0cd49c05216742d42fc8ecbfbe6b67083412b609bd3.css><link rel=stylesheet href=https://blog.oddbit.com/css/syntax.min.a0773cce9310cb6d8ed23e50f005448facf29a53001b57e038828daa466b25c0.css><link rel=stylesheet href=https://blog.oddbit.com/css/terminal.min.e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855.css><link rel=stylesheet href=https://blog.oddbit.com/css/terms.min.b81791663c3790e738e571cdbf802312390d30e4b1d8dc9d814a5b5454d0ac11.css><link rel=stylesheet href=https://blog.oddbit.com/style.css><link rel="shortcut icon" href=https://blog.oddbit.com/favicon.png><link rel=apple-touch-icon href=https://blog.oddbit.com/apple-touch-icon.png><meta name=twitter:card content="summary"><meta property="og:locale" content="en"><meta property="og:type" content="website"><meta property="og:title" content><meta property="og:description" content><meta property="og:url" content="https://blog.oddbit.com/posts/"><meta property="og:site_name" content="blog.oddbit.com"><meta property="og:image" content="https://blog.oddbit.com/og-image.png"><meta property="og:image:width" content="1200"><meta property="og:image:height" content="627"><link href=/posts/rss.xml rel=alternate type=application/rss+xml title=blog.oddbit.com></head><body><div class="container center"><header class=header><div class=header__inner><div class=header__logo><a href=/><div class=logo>the odd bit blog</div></a></div><ul class="menu menu--mobile"><li class=menu__trigger>Menu&nbsp;▾</li><li><ul class=menu__dropdown><li><a href=/>/</a></li><li><a href=https://oddbit.com>/about</a></li><li><a href=/posts>/posts</a></li><li><a href=/tags>/tags</a></li><li><a href=/archive>/archive</a></li><li><a href=/rss.xml>/feed</a></li><li><a href=https://github.com/larsks>→Github</a></li><li><a href=https://hachyderm.io/@larsks>→Mastodon</a></li><li><a href=https://twitter.com/larsks>→Twitter</a></li></ul></li></ul></div><nav class=navigation-menu><ul class="navigation-menu__inner menu--desktop"><li><a href=/>/</a></li><li><a href=https://oddbit.com>/about</a></li><li><a href=/posts>/posts</a></li><li><a href=/tags>/tags</a></li><li><a href=/archive>/archive</a></li><li><a href=/rss.xml>/feed</a></li><li><ul class=menu><li class=menu__trigger>&nbsp;▾</li><li><ul class=menu__dropdown><li><a href=https://github.com/larsks>→Github</a></li><li><a href=https://hachyderm.io/@larsks>→Mastodon</a></li><li><a href=https://twitter.com/larsks>→Twitter</a></li></ul></li></ul></li></ul></nav></header><div class=content><div class=posts><article class="post on-list"><h2 class=post-title><a href=https://blog.oddbit.com/post/2018-02-26-grouping-aggregation-queries-i/>Grouping aggregation queries in Gnocchi 4.0.x</a></h2><div class=post-meta><time class=post-date>2018-02-26</time></div><span class=post-tags>#<a href=https://blog.oddbit.com/tags/openstack/>openstack</a>&nbsp;
#<a href=https://blog.oddbit.com/tags/gnocchi/>gnocchi</a>&nbsp;
#<a href=https://blog.oddbit.com/tags/metrics/>metrics</a>&nbsp;</span><div class=post-content><p>In this article, we&rsquo;re going to ask Gnocchi (the OpenStack telemetry
storage service) how much memory was used, on average, over the course
of each day by each project in an OpenStack environment.</p><h2 id=environment>Environment</h2><p>I&rsquo;m working with an OpenStack &ldquo;Pike&rdquo; deployment, which means I have
Gnocchi 4.0.x. More recent versions of Gnocchi (4.1.x and later) have
a new aggregation API called <a href=https://gnocchi.xyz/rest.html#dynamic-aggregates>dynamic aggregates</a>, but that isn&rsquo;t
available in 4.0.x so in this article we&rsquo;ll be using the legacy
<code>/v1/aggregations</code> API.</p></div><div><a class="read-more button inline" href=/post/2018-02-26-grouping-aggregation-queries-i/>[read more]</a></div></article><article class="post on-list"><h2 class=post-title><a href=https://blog.oddbit.com/post/2018-02-08-listing-iptables-rules-with-li/>Listing iptables rules with line numbers</a></h2><div class=post-meta><time class=post-date>2018-02-08</time></div><span class=post-tags>#<a href=https://blog.oddbit.com/tags/shell/>shell</a>&nbsp;
#<a href=https://blog.oddbit.com/tags/iptables/>iptables</a>&nbsp;</span><div class=post-content><p>You can list <code>iptables</code> rules with rule numbers using the
<code>--line-numbers</code> option, but this only works in list (<code>-L</code>) mode. I
find it much more convenient to view rules using the output from
<code>iptables -S</code> or <code>iptables-save</code>.</p><p>You can augment the output from these commands with rule numbers with
the following <code>awk</code> script:</p><pre><code>#!/bin/awk -f

state == 0 &amp;&amp; /^-A/ {state=1; chain=$2; counter=1; printf &quot;\n&quot;}
state == 1 &amp;&amp; $2 != chain {chain=$2; counter=1; printf &quot;\n&quot;}
!/^-A/ {state=0}
state == 1 {printf &quot;[%03d] %s\n&quot;, counter++, $0}
state == 0 {print}
</code></pre><p>This will produce output along the lines of:</p></div><div><a class="read-more button inline" href=/post/2018-02-08-listing-iptables-rules-with-li/>[read more]</a></div></article><article class="post on-list"><h2 class=post-title><a href=https://blog.oddbit.com/post/2018-01-26-pelican-theme-update/>Pelican and theme update</a></h2><div class=post-meta><time class=post-date>2018-01-26</time></div><span class=post-tags>#<a href=https://blog.oddbit.com/tags/administrivia/>administrivia</a>&nbsp;</span><div class=post-content><p>I&rsquo;ve just refreshed the version of <a href=https://github.com/getpelican/pelican>Pelican</a> used to generate this
blog, along with the associated themes and plugins. It all seems to be
working, but if you spot a problem feel free to <a href=https://github.com/larsks/blog.oddbit.com/issues>drop me a line</a>.</p></div><div><a class="read-more button inline" href=/post/2018-01-26-pelican-theme-update/>[read more]</a></div></article><article class="post on-list"><h2 class=post-title><a href=https://blog.oddbit.com/post/2018-01-25-fun-with-devicemapper-snapshot/>Fun with devicemapper snapshots</a></h2><div class=post-meta><time class=post-date>2018-01-25</time></div><span class=post-tags>#<a href=https://blog.oddbit.com/tags/storage/>storage</a>&nbsp;
#<a href=https://blog.oddbit.com/tags/devicemapper/>devicemapper</a>&nbsp;</span><div class=post-content><p>I find myself working with <a href=https://www.raspberrypi.org/downloads/raspbian/>Raspbian</a> disk images fairly often. A
typical workflow is:</p><ul><li>Download the disk image.</li><li>Mount the filesystem somewhere to check something.</li><li>Make some changes or install packages just to check something else.</li><li>Crap I&rsquo;ve made changes.</li></ul><p>&mldr;at which point I need to fetch a new copy of the image next time I
want to start fresh.</p><p>Sure, I could just make a copy of the image and work from there, but
what fun is that? This seemed like a perfect opportunity to learn more
about the <a href=https://www.kernel.org/doc/Documentation/device-mapper/>device mapper</a> and in particular how the <a href=https://www.kernel.org/doc/Documentation/device-mapper/snapshot.txt>snapshot</a>
target works.</p></div><div><a class="read-more button inline" href=/post/2018-01-25-fun-with-devicemapper-snapshot/>[read more]</a></div></article><article class="post on-list"><h2 class=post-title><a href=https://blog.oddbit.com/post/2018-01-24-safely-restarting-an-openstack/>Safely restarting an OpenStack server with Ansible</a></h2><div class=post-meta><time class=post-date>2018-01-24</time></div><span class=post-tags>#<a href=https://blog.oddbit.com/tags/ansible/>ansible</a>&nbsp;
#<a href=https://blog.oddbit.com/tags/openstack/>openstack</a>&nbsp;</span><div class=post-content><p>The other day on <a href=http://docs.ansible.com/ansible/latest/community.html#irc-channel>#ansible</a>, someone was looking for a way to safely
shut down a Nova server, wait for it to stop, and then start it up
again using the <code>openstack</code> cli. The first part seemed easy:</p><pre><code>- hosts: myserver
  tasks:
    - name: shut down the server
      command: poweroff
      become: true
</code></pre><p>&mldr;but that will actually fail with the following result:</p><pre><code>TASK [shut down server] *************************************
fatal: [myserver]: UNREACHABLE! =&gt; {&quot;changed&quot;: false, &quot;msg&quot;:
&quot;Failed to connect to the host via ssh: Shared connection to
10.0.0.103 closed.\r\n&quot;, &quot;unreachable&quot;: true}
</code></pre><p>This happens because running <code>poweroff</code> immediately closes Ansible&rsquo;s
ssh connection. The workaround here is to use a &ldquo;fire-and-forget&rdquo;
<a href=http://docs.ansible.com/ansible/latest/playbooks_async.html>asynchronous task</a>:</p></div><div><a class="read-more button inline" href=/post/2018-01-24-safely-restarting-an-openstack/>[read more]</a></div></article><article class="post on-list"><h2 class=post-title><a href=https://blog.oddbit.com/post/2017-09-26-some-notes-on-pwm-on-the-raspb/>Some notes on PWM on the Raspberry Pi</a></h2><div class=post-meta><time class=post-date>2017-09-26</time></div><span class=post-tags>#<a href=https://blog.oddbit.com/tags/raspberrypi/>raspberrypi</a>&nbsp;
#<a href=https://blog.oddbit.com/tags/pwm/>pwm</a>&nbsp;</span><div class=post-content><p>I was recently working on a project in which I wanted to drive a
simple <a href=https://www.adafruit.com/product/160>piezo buzzer</a> attached to a GPIO pin on a Raspberry Pi. I
was already using the <a href=https://pypi.python.org/pypi/RPi.GPIO>RPi.GPIO</a> module in my project so that seemed
like a logical place to start, but I ran into a few issues.</p><p>You drive a piezo buzzer by generating a <a href=https://learn.sparkfun.com/tutorials/pulse-width-modulation>PWM</a> signal with the
appropriate frequency. The <code>RPi.GPIO</code> module implements PWM via
software, which is tricky on a non-realtime system. It&rsquo;s difficult to
get the timing completely accurate, which results in sounds that are a
little wobbly at best. Since I&rsquo;m simply generating tones with a
buzzer (rather than, say, controlling a servo) this is mostly just an
annoyance.</p></div><div><a class="read-more button inline" href=/post/2017-09-26-some-notes-on-pwm-on-the-raspb/>[read more]</a></div></article><article class="post on-list"><h2 class=post-title><a href=https://blog.oddbit.com/post/2017-08-02-ansible-for-infrastructure-tes/>Ansible for Infrastructure Testing</a></h2><div class=post-meta><time class=post-date>2017-08-02</time></div><span class=post-tags>#<a href=https://blog.oddbit.com/tags/ansible/>ansible</a>&nbsp;
#<a href=https://blog.oddbit.com/tags/ansible-assertive/>ansible-assertive</a>&nbsp;
#<a href=https://blog.oddbit.com/tags/openstack/>openstack</a>&nbsp;</span><div class=post-content><p>At <code>$JOB</code> we often find ourselves at customer sites where we see the
same set of basic problems that we have previously encountered
elsewhere (&ldquo;your clocks aren&rsquo;t in sync&rdquo; or &ldquo;your filesystem is full&rdquo;
or &ldquo;you haven&rsquo;t installed a critical update&rdquo;, etc). We would like a
simple tool that could be run either by the customer or by our own
engineers to test for and report on these common issues.
Fundamentally, we want something that acts like a typical code test
suite, but for infrastructure.</p></div><div><a class="read-more button inline" href=/post/2017-08-02-ansible-for-infrastructure-tes/>[read more]</a></div></article><article class="post on-list"><h2 class=post-title><a href=https://blog.oddbit.com/post/2017-07-07-better-bulk-filtering-for-gmai/>Better bulk filtering for Gmail</a></h2><div class=post-meta><time class=post-date>2017-07-07</time></div><span class=post-tags>#<a href=https://blog.oddbit.com/tags/gmail/>gmail</a>&nbsp;</span><div class=post-content><p>I use Gmail extensively for my personal email, and recently my
workplace has been migrated over to Gmail as well. I find that for my
work email I rely much more extensively on filters and labels to
organize things (like zillions of internal and upstream mailing
lists), and that has posed some challenges. While Gmail is in general
fairly snappy, attempting to apply an action to thousands of messages
(for example, trying to mark 16000 messages as &ldquo;read&rdquo;, or applying a
new filter to all your existing messages) results in a very poor
experience: it is not possible to interact with Gmail (in the same
tab) while the action is running, and frequently actions will timeout.</p></div><div><a class="read-more button inline" href=/post/2017-07-07-better-bulk-filtering-for-gmai/>[read more]</a></div></article><article class="post on-list"><h2 class=post-title><a href=https://blog.oddbit.com/post/2017-06-14-openstack-containers-and-loggi/>OpenStack, Containers, and Logging</a></h2><div class=post-meta><time class=post-date>2017-06-14</time></div><span class=post-tags>#<a href=https://blog.oddbit.com/tags/openstack/>openstack</a>&nbsp;
#<a href=https://blog.oddbit.com/tags/logging/>logging</a>&nbsp;</span><div class=post-content><p>I&rsquo;ve been thinking about logging in the context of OpenStack and containerized service deployments. I&rsquo;d like to lay out some of my thoughts on this topic and see if people think I am talking crazy or not.</p><p>There are effectively three different mechanisms that an application can use to emit log messages:</p><ul><li>Via some logging-specific API, such as the legacy syslog API</li><li>By writing a byte stream to stdout/stderr</li><li>By writing a byte stream to a file</li></ul><p>A substantial advantage to the first mechanism (using a logging API) is that the application is logging <em>messages</em> rather than <em>bytes</em>. This means that if you log a message containing embedded newlines (e.g., python or java tracebacks), you can collect that as a single message rather than having to impose some sort of structure on the byte stream after the fact in order to reconstruct those message.</p></div><div><a class="read-more button inline" href=/post/2017-06-14-openstack-containers-and-loggi/>[read more]</a></div></article><article class="post on-list"><h2 class=post-title><a href=https://blog.oddbit.com/post/2017-05-25-faa-cannot-require-drone-regis/>FAA Cannot Require Drone Registration</a></h2><div class=post-meta><time class=post-date>2017-05-25</time></div><span class=post-tags>#<a href=https://blog.oddbit.com/tags/uav/>uav</a>&nbsp;
#<a href=https://blog.oddbit.com/tags/faa/>faa</a>&nbsp;</span><div class=post-content><p>This is now old news if you&rsquo;re already following the drone industry,
but if you&rsquo;re not, I&rsquo;d like to highlight a recent decision made by the
US Court of Appeals regarding the FAA&rsquo;s drone registration
requirements.</p><p>To place this in context, back in 2015 the FAA established a new set
of regulations (the &ldquo;Registration Rule&rdquo;) requiring anyone with a UAV
(&ldquo;unmanned aerial vehicle&rdquo;, or &ldquo;drone&rdquo;) weighing between 0.5 and 55
lbs to register with the FAA. Unfortunately, the 2012 <a href=https://www.congress.gov/bill/112th-congress/house-bill/658/text>FAA
Modernization and Reform Act says</a> says (in section 336(a)):</p></div><div><a class="read-more button inline" href=/post/2017-05-25-faa-cannot-require-drone-regis/>[read more]</a></div></article><div class=pagination><div class=pagination__buttons><a href=/posts/page/7/ class="button inline prev">&lt; [<span class=button__text>Newer posts</span>]
</a>::
<a href=/posts/page/9/ class="button inline next">[<span class=button__text>Older posts</span>] ></a></div></div></div></div><footer class=footer><div class=footer__inner><div class="copyright copyright--user"><span>Lars Kellogg-Stedman</span>
<span>:: <a href=https://github.com/panr/hugo-theme-terminal target=_blank>Theme</a> made by <a href=https://github.com/panr target=_blank>panr</a></span></div></div></footer><script type=text/javascript src=/bundle.min.js></script><script src=/js/mermaid.min.js></script><script>mermaid.initialize({startOnLoad:!0})</script></div></body></html>